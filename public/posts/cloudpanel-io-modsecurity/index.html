<!DOCTYPE html>
<html lang="en-us">
<head>
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <script type="text/javascript" src="https://latest.cactus.chat/cactus.js"></script>
  <link rel="stylesheet" href="https://latest.cactus.chat/style.css" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> Adding ModSecurity to CloudPanel.io | berndklaus.at</title>
  <link rel = 'canonical' href = 'https://berndklaus.at/posts/cloudpanel-io-modsecurity/'>
  <meta name="description" content="A very warm welcome to my little space, glad you found it! News or current topics concerning IT, which I actually deal with, are published here on a cyclical basis. **Topics:** *#K8s #ITSecurity #CloudComputing #EdgeComputing #DevOps #Serverless*">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="Adding ModSecurity to CloudPanel.io" />
<meta property="og:description" content="CloudPanel.io CloudPanel beschreibt sich selbst wie folgt:
CloudPanel is a modern server control panel with lightweight components for PHP applications with specific features for all major clouds. It has been developed with more than ten years of Magento hosting experience in the AWS cloud. With CloudPanel, you can run your favorite PHP application in any cloud or dedicated server within minutes.
Homepage: https://www.cloudpanel.ioIm unterschied zur Konkurrenz wie Beispielsweise CyberPanel, Plesk oder VestaCP konzentriet sich CloudPanel auf das wesentliche." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://berndklaus.at/posts/cloudpanel-io-modsecurity/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-10-16T13:55:49+01:00" />
<meta property="article:modified_time" content="2020-10-16T13:55:49+01:00" />


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Adding ModSecurity to CloudPanel.io"/>
<meta name="twitter:description" content="CloudPanel.io CloudPanel beschreibt sich selbst wie folgt:
CloudPanel is a modern server control panel with lightweight components for PHP applications with specific features for all major clouds. It has been developed with more than ten years of Magento hosting experience in the AWS cloud. With CloudPanel, you can run your favorite PHP application in any cloud or dedicated server within minutes.
Homepage: https://www.cloudpanel.ioIm unterschied zur Konkurrenz wie Beispielsweise CyberPanel, Plesk oder VestaCP konzentriet sich CloudPanel auf das wesentliche."/>

  
  
    
  
  
  <link rel="stylesheet" href="https://berndklaus.at/css/styles.aad1faec83a1003df3ee7287b7bdee1cb3a7b411021436c32f37e0c55ac71264c3944bcc1b35e12ac6c9f0249afdca485a9f510d1685639a35c84ba9367d6a6e.css" integrity="sha512-qtH67IOhAD3z7nKHt73uHLOntBECFDbDLzfgxVrHEmTDlEvMGzXhKsbJ8CSa/cpIWp9RDRaFY5o1yEupNn1qbg=="> 

  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://berndklaus.at/images/favicon.ico" />

  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

  <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts">Posts</a></li>
         
        <li><a href="/about">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li>
          <a class="icon" href=" https://berndklaus.at/posts/kubernetes-guide/" aria-label="Previous">
            <i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i>
          </a>
        </li>
        
        
        <li>
          <a class="icon" href="https://berndklaus.at/posts/secure-remote-access/" aria-label="Next">
            <i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i>
          </a>
        </li>
        
        <li>
          <a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
            <i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="#" aria-label="Share">
            <i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
          </a>
        </li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fberndklaus.at%2fposts%2fcloudpanel-io-modsecurity%2f" aria-label="Facebook">
      <i class="fab fa-facebook " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fberndklaus.at%2fposts%2fcloudpanel-io-modsecurity%2f&text=Adding%20ModSecurity%20to%20CloudPanel.io" aria-label="Twitter">
      <i class="fab fa-twitter " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fberndklaus.at%2fposts%2fcloudpanel-io-modsecurity%2f&title=Adding%20ModSecurity%20to%20CloudPanel.io" aria-label="Linkedin">
      <i class="fab fa-linkedin " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fberndklaus.at%2fposts%2fcloudpanel-io-modsecurity%2f&is_video=false&description=Adding%20ModSecurity%20to%20CloudPanel.io" aria-label="Pinterest">
      <i class="fab fa-pinterest " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Adding%20ModSecurity%20to%20CloudPanel.io&body=Check out this article: https%3a%2f%2fberndklaus.at%2fposts%2fcloudpanel-io-modsecurity%2f" aria-label="Email">
      <i class="fas fa-envelope " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fberndklaus.at%2fposts%2fcloudpanel-io-modsecurity%2f&title=Adding%20ModSecurity%20to%20CloudPanel.io" aria-label="Pocket">
      <i class="fab fa-get-pocket " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fberndklaus.at%2fposts%2fcloudpanel-io-modsecurity%2f&title=Adding%20ModSecurity%20to%20CloudPanel.io" aria-label="reddit">
      <i class="fab fa-reddit " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fberndklaus.at%2fposts%2fcloudpanel-io-modsecurity%2f&name=Adding%20ModSecurity%20to%20CloudPanel.io&description=CloudPanel.io%20CloudPanel%20beschreibt%20sich%20selbst%20wie%20folgt%3a%0aCloudPanel%20is%20a%20modern%20server%20control%20panel%20with%20lightweight%20components%20for%20PHP%20applications%20with%20specific%20features%20for%20all%20major%20clouds.%20It%20has%20been%20developed%20with%20more%20than%20ten%20years%20of%20Magento%20hosting%20experience%20in%20the%20AWS%20cloud.%20With%20CloudPanel%2c%20you%20can%20run%20your%20favorite%20PHP%20application%20in%20any%20cloud%20or%20dedicated%20server%20within%20minutes.%0aHomepage%3a%20https%3a%2f%2fwww.cloudpanel.io%0dIm%20unterschied%20zur%20Konkurrenz%20wie%20Beispielsweise%20CyberPanel%2c%20Plesk%20oder%20VestaCP%20konzentriet%20sich%20CloudPanel%20auf%20das%20wesentliche." aria-label="Tumblr">
      <i class="fab fa-tumblr " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fberndklaus.at%2fposts%2fcloudpanel-io-modsecurity%2f&t=Adding%20ModSecurity%20to%20CloudPanel.io" aria-label="Hacker News">
      <i class="fab fa-hacker-news " aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>
    
    <div id="toc">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#cloudpanelio">CloudPanel.io</a></li>
    <li><a href="#modsecurity">ModSecurity</a></li>
    <li><a href="#coreruleset">CoreRuleSet</a></li>
    <li><a href="#installation">Installation</a>
      <ul>
        <li><a href="#cloudpanel">CloudPanel</a></li>
        <li><a href="#requirements">Requirements</a></li>
        <li><a href="#download-modsecurity">Download ModSecurity</a></li>
        <li><a href="#compile-modsecurity">Compile ModSecurity</a></li>
        <li><a href="#compile-the-nginx-connector">Compile the nginx connector</a></li>
        <li><a href="#download-coreruleset">Download CoreRuleSet</a></li>
        <li><a href="#configure-the-coreruleset--modsecurity">Configure the CoreRuleSet &amp; ModSecurity</a></li>
        <li><a href="#configure-nginx">Configure Nginx</a></li>
        <li><a href="#enable--verify">Enable &amp; Verify</a></li>
        <li><a href="#enable-coreruleset">Enable CoreRuleSet</a></li>
        <li><a href="#test-modsecurity">Test ModSecurity</a></li>
        <li><a href="#finish">Finish</a></li>
      </ul>
    </li>
    <li><a href="#attentione">Attentione</a></li>
    <li><a href="#quellen">Quellen</a></li>
  </ul>
</nav>
    </div>
    
  </span>
</div>


  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 class="posttitle" itemprop="name headline">
        Adding ModSecurity to CloudPanel.io
      </h1>
      <div class="meta">
        
        <div class="postdate">
          
          <time datetime="2020-10-16 13:55:49 &#43;0100 &#43;0100" itemprop="datePublished">2020-10-16</time>
          
        </div>
        
        
        
        
        <div class="article-tag">
            <i class="fas fa-tag"></i>
            
            
            <a class="tag-link" href="/tags/server" rel="tag">Server</a>
            
             ,  
            <a class="tag-link" href="/tags/cloudpanel" rel="tag">CloudPanel</a>
            
             ,  
            <a class="tag-link" href="/tags/modsecurity" rel="tag">ModSecurity</a>
            
             ,  
            <a class="tag-link" href="/tags/security" rel="tag">Security</a>
            
        </div>
        
      </div>
    </header>

  
    
    <div class="content" itemprop="articleBody">
      <h2 id="cloudpanelio">CloudPanel.io</h2>
<p>CloudPanel beschreibt sich selbst wie folgt:</p>
<p><em>CloudPanel is a modern server control panel with lightweight components for PHP applications with specific features for all major clouds. It has been developed with more than ten years of Magento hosting experience in the AWS cloud. With CloudPanel, you can run your favorite PHP application in any cloud or dedicated server within minutes.</em></p>
<p><strong>Homepage:</strong> <a href="https://www.cloudpanel.io" target="_blank">https://www.cloudpanel.io</a>
</p>
<p>Im unterschied zur Konkurrenz wie Beispielsweise CyberPanel, Plesk oder VestaCP konzentriet sich CloudPanel auf das wesentliche. Die Oberfläche ist dermaßen aufgeräumt, fast schon klinisch rein. So mag ich das!</p>
<p>Damit Ihr einen eindruck davon bekommt, hier die Willkommens-Seite:</p>
<p><img src="/images/cloudpanel-dashboard.png" alt="CloudPanel Interface"></p>
<p>Der Gesamteindruck ist wirklich hervorragend. Alles smooth, keine Popus oder zusätzliche Fenster, welchen einem anspringen und PhpMyAdmin ist mit Auto-Logon versehen.</p>
<p>Ein Feature vermisse ich jedoch: <strong>ModSecurity</strong>.</p>
<p>Zwar ist ein IP/Bot Block-Mechanismus bereits implementiert, mit den Features von ModSecurity kann das jedoch nicht ganz mithalten.</p>
<h2 id="modsecurity">ModSecurity</h2>
<p>ModSecurity ist eine vollwertige WAF, welche sich als Modul in Nginx integrieren lässt. Ursprünglich für Apache geschrieben, über die Jahre wurde das Projekt jedoch ständig erweitert. Heute gibt es für fast jeden bekannten WebServer ein derartiges Modul.</p>
<p>ModSecurity’s Intro startet wie folgt:</p>
<p><em>ModSecurity is a toolkit for real-time web application monitoring, logging, and access control. I like to think about it as an enabler: there are no hard rules telling you what to do; instead, it is up to you to choose your own path through the available features. That’s why the title of this section asks what ModSecurity can do, not what it does.</em></p>
<p><img src="/images/modsecurity-logo.png" alt="ModSecurity Logo"></p>
<h2 id="coreruleset">CoreRuleSet</h2>
<p>Dabei handelt es sich um eine Erweiterung für ModSecurity welche eine fertige Regelsammlung enthält. Damit kann eine Vielzahl an unterschiedlichen Attacken ohne “großen Aufwand” abgefangen werden. Das Regelset lässt sich dabei Modulr erweitern und verfeiner.</p>
<p>Weitere Informationen zum Projekt: <a href="https://coreruleset.org" target="_blank">https://coreruleset.org</a>
</p>
<h2 id="installation">Installation</h2>
<h3 id="cloudpanel">CloudPanel</h3>
<p>Verbindet euch via SSH auf eure Debian 10 VM (Ubuntu und CentOS werden nicht untersützt, CentOS support soll jedoch folgen). Installation von CloudPanel:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">apt update <span style="color:#000;font-weight:bold">&amp;&amp;</span> apt -y upgrade <span style="color:#000;font-weight:bold">&amp;&amp;</span> apt -y install curl wget sudo
curl -sSL https://installer.cloudpanel.io/ce/v1/install.sh | sudo bash</code></pre></div>
<p>Je nach Cloud-Provider bietet CloudPanel unterschiedliche Installer bzw. fertige Images: <a href="https://www.cloudpanel.io/docs/cloudpanel-ce/getting-started" target="_blank">https://www.cloudpanel.io/docs/cloudpanel-ce/getting-started</a>
</p>
<p>Im aktuellen Fall wird das Paket auf einem “nicht unterstützten” Cloud-Provider installiert.</p>
<h3 id="requirements">Requirements</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">apt-get install libtool autoconf build-essential libpcre3-dev zlib1g-dev libssl-dev libxml2-dev libgeoip-dev liblmdb-dev libyajl-dev libcurl4-openssl-dev libpcre++-dev pkgconf libxslt1-dev libgd-dev automake</code></pre></div>
<h3 id="download-modsecurity">Download ModSecurity</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#0086b3">cd</span> /opt/
<span style="color:#998;font-style:italic"># The correct command for downloading the latest Libmodsecurity source code</span>
git clone --depth <span style="color:#099">100</span> -b v3/master --single-branch https://github.com/SpiderLabs/ModSecurity
<span style="color:#0086b3">cd</span> ModSecurity
git submodule init
git submodule update</code></pre></div>
<h3 id="compile-modsecurity">Compile ModSecurity</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#998;font-style:italic"># Generate configure file</span>
sh build.sh
<span style="color:#998;font-style:italic"># Pre compilation step. Checks for dependencies</span>
./configure
<span style="color:#998;font-style:italic"># Compiles the source code</span>
make
<span style="color:#998;font-style:italic"># grab a Coffee! That&#39;s going to take its time.</span>
<span style="color:#998;font-style:italic"># Installs the Libmodsecurity to **/usr/local/modsecurity/lib/libmodsecurity.so**</span>
make install</code></pre></div>
<h3 id="compile-the-nginx-connector">Compile the nginx connector</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#0086b3">cd</span> /opt/
<span style="color:#998;font-style:italic"># Fetch the Nginx source code. See the directory: **http://nginx.org/download/** for all versions of Nginx</span>
wget http://nginx.org/download/nginx-1.18.0.tar.gz
<span style="color:#998;font-style:italic"># Extract the downloaded source code</span>
gunzip nginx-1.18.0.tar.gz
tar -xvf nginx-1.18.0.tar
rm nginx-1.18.0.tar
<span style="color:#998;font-style:italic"># Fetch the source code for ModSecurity-nginx connector</span>
git clone https://github.com/SpiderLabs/ModSecurity-nginx
<span style="color:#998;font-style:italic"># Change directory to the Nginx source code</span>
<span style="color:#0086b3">cd</span> nginx-1.18.0/
<span style="color:#998;font-style:italic"># Compile the Nginx </span>
./configure --with-cc-opt<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;-g -O2 -fdebug-prefix-map=/home/clp/packaging/nginx/tmp/nginx-1.18.0=. -fstack-protector-strong -Wformat -Werror=format-security -fPIC -Wdate-time -D_FORTIFY_SOURCE=2&#39;</span> --with-ld-opt<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;-Wl,-z,relro -Wl,-z,now -fPIC&#39;</span> --prefix<span style="color:#000;font-weight:bold">=</span>/usr/share/nginx --conf-path<span style="color:#000;font-weight:bold">=</span>/etc/nginx/nginx.conf --http-log-path<span style="color:#000;font-weight:bold">=</span>/var/log/nginx/access.log --error-log-path<span style="color:#000;font-weight:bold">=</span>/var/log/nginx/error.log --lock-path<span style="color:#000;font-weight:bold">=</span>/var/lock/nginx.lock --pid-path<span style="color:#000;font-weight:bold">=</span>/run/nginx.pid --modules-path<span style="color:#000;font-weight:bold">=</span>/usr/lib/nginx/modules --http-client-body-temp-path<span style="color:#000;font-weight:bold">=</span>/var/lib/nginx/body --http-fastcgi-temp-path<span style="color:#000;font-weight:bold">=</span>/var/lib/nginx/fastcgi --http-proxy-temp-path<span style="color:#000;font-weight:bold">=</span>/var/lib/nginx/proxy --http-scgi-temp-path<span style="color:#000;font-weight:bold">=</span>/var/lib/nginx/scgi --http-uwsgi-temp-path<span style="color:#000;font-weight:bold">=</span>/var/lib/nginx/uwsgi --with-debug --with-pcre-jit --with-http_ssl_module --with-http_stub_status_module --with-http_realip_module --with-http_auth_request_module --with-http_v2_module --with-http_dav_module --with-http_slice_module --with-threads --with-http_addition_module --with-http_geoip_module<span style="color:#000;font-weight:bold">=</span>dynamic --with-http_gunzip_module --with-http_gzip_static_module --with-http_image_filter_module<span style="color:#000;font-weight:bold">=</span>dynamic --with-http_sub_module --with-http_xslt_module<span style="color:#000;font-weight:bold">=</span>dynamic --with-stream<span style="color:#000;font-weight:bold">=</span>dynamic --with-stream_ssl_module --with-stream_ssl_preread_module --with-mail<span style="color:#000;font-weight:bold">=</span>dynamic --with-mail_ssl_module  --add-dynamic-module<span style="color:#000;font-weight:bold">=</span>/opt/ModSecurity-nginx
<span style="color:#998;font-style:italic"># Generate the module</span>
make modules
<span style="color:#998;font-style:italic"># Copy the module to the Nginx module directory</span>
cp objs/ngx_http_modsecurity_module.so /usr/share/nginx/modules</code></pre></div>
<h3 id="download-coreruleset">Download CoreRuleSet</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#998;font-style:italic"># Create the modsec folder in the Nginx configuration folder. It will contain the ModSec rules</span>
mkdir /etc/cloudpanel/services/clp-nginx/modsec
<span style="color:#998;font-style:italic"># Change directory</span>
<span style="color:#0086b3">cd</span> /etc/cloudpanel/services/clp-nginx/modsec
<span style="color:#998;font-style:italic"># Download the rules</span>
git clone https://github.com/SpiderLabs/owasp-modsecurity-crs.git
<span style="color:#998;font-style:italic"># Rename the default ModSecurity rules configuration file</span>
mv /etc/cloudpanel/services/clp-nginx/modsec/owasp-modsecurity-crs/crs-setup.conf.example /etc/cloudpanel/services/clp-nginx/modsec/owasp-modsecurity-crs/crs-setup.conf</code></pre></div>
<h3 id="configure-the-coreruleset--modsecurity">Configure the CoreRuleSet &amp; ModSecurity</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#998;font-style:italic"># Copy the default ModSecurity configuration file to the modesec folder</span>
cp /opt/ModSecurity/modsecurity.conf-recommended /etc/cloudpanel/services/clp-nginx/modsec/modsecurity.conf
<span style="color:#998;font-style:italic"># Create a configuration file that will be loaded by Nginx. This file will load the ModSec rules configuration file and the ModSec configuration file</span>
nano /etc/cloudpanel/services/clp-nginx/modsec/main.conf
<span style="color:#998;font-style:italic"># Add following lines to the file</span>
Include /etc/cloudpanel/services/clp-nginx/modsec/modsecurity.conf
Include /etc/cloudpanel/services/clp-nginx/modsec/owasp-modsecurity-crs/crs-setup.conf
SecRuleRemoveById <span style="color:#099">933100</span>
SecRuleRemoveById <span style="color:#099">933120</span>
Include /etc/cloudpanel/services/clp-nginx/modsec/owasp-modsecurity-crs/rules/*.conf</code></pre></div>
<h3 id="configure-nginx">Configure Nginx</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">nano /etc/cloudpanel/services/clp-nginx/modules-enabled/50-mod-http-modsecurity.conf
<span style="color:#998;font-style:italic"># Add the following lin</span>
load_module modules/ngx_http_modsecurity_module.so;
<span style="color:#998;font-style:italic"># Edit next file</span>
nano /etc/cloudpanel/services/clp-nginx/nginx.conf
<span style="color:#998;font-style:italic"># Add the following line to the file, after: worker_rlimit_nofile 8192 - should be Line 5</span>
include /etc/cloudpanel/services/clp-nginx/modules-enabled/*.conf;
<span style="color:#998;font-style:italic">## Enable for the CloudPanel</span>
nano /etc/cloudpanel/services/clp-nginx/sites-enabled/cloudpanel.conf
<span style="color:#998;font-style:italic"># Add following lines to the file, after:   server_name _ - should be Line 3&amp;4</span>
modsecurity on;
modsecurity_rules_file /etc/cloudpanel/services/clp-nginx/modsec/main.conf;</code></pre></div>
<h3 id="enable--verify">Enable &amp; Verify</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">chown -R clp-admin /etc/cloudpanel/services/clp-nginx/modsec/
chgrp -R clp /etc/cloudpanel/services/clp-nginx/modsec/
chown clp-admin /etc/cloudpanel/services/clp-nginx/nginx.conf
chgrp clp /etc/cloudpanel/services/clp-nginx/nginx.conf
<span style="color:#998;font-style:italic"># Restart Nginx</span>
systemctl restart clp-nginx
<span style="color:#998;font-style:italic"># If you see an error that mentions missing **unicode.mapping** file, then copy the file to the mod sec folder</span>
cp /opt/ModSecurity/unicode.mapping /etc/cloudpanel/services/clp-nginx/modsec/
<span style="color:#998;font-style:italic"># Check Process with</span>
systemctl status clp-nginx
<span style="color:#998;font-style:italic"># If the process did not start check:</span>
cat /var/log/syslog</code></pre></div>
<h3 id="enable-coreruleset">Enable CoreRuleSet</h3>
<p>Per Default CoreRuleSet is enable in DetectOnly Mode. Fully enable it:
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">nano /etc/cloudpanel/services/clp-nginx/modsec/modsecurity.conf
<span style="color:#998;font-style:italic">## Change DetectionOnly to On</span>
<span style="color:#998;font-style:italic">#SecRuleEngine DetectionOnly</span>
SecRuleEngine On</code></pre></div></p>
<h3 id="test-modsecurity">Test ModSecurity</h3>
<p>Fire off your Shellshock:
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl https://YOURIP:8443/login --insecure -H <span style="color:#d14">&#34;custom:() { ignored; }; echo Content-Type: text/html; echo ; /bin/cat /etc/passwd&#34;</span></code></pre></div></p>
<p>Should response:
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">&lt;head&gt;&lt;title&gt;403 Forbidden&lt;/title&gt;&lt;/head&gt;</code></pre></div></p>
<h3 id="finish">Finish</h3>
<p>Super, wir haben nun ModSecurity und CoreRuleSet auf unserem Server installiert und den vorhandenen Stack damit erweitert. Zugegeben, die notwendige Teile selbst zu compilieren ist nicht trivial, aufgrund der erhöhten Sicherheit zahlt es sich aber allemal aus!</p>
<h2 id="attentione">Attentione</h2>
<p>Um “False Positives” vorzubeugen solltet ihr auf das Control-Panel über einen Hostname zugreifen und nicht via IP-Addresse.</p>
<h2 id="quellen">Quellen</h2>
<p><a href="https://pakjiddat.netlify.app/posts/integrating-modsecurity-with-nginx-on-debian-9" target="_blank">https://pakjiddat.netlify.app/posts/integrating-modsecurity-with-nginx-on-debian-9</a>

<a href="https://samhobbs.co.uk/2016/03/getting-started-apache-modsecurity-debian-and-ubuntu" target="_blank">https://samhobbs.co.uk/2016/03/getting-started-apache-modsecurity-debian-and-ubuntu</a>

<a href="https://www.cloudpanel.io/docs" target="_blank">https://www.cloudpanel.io/docs</a>
</p>

    </div>
  </article>

  
  






  <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/posts">Posts</a></li>
         
          <li><a href="/about">About</a></li>
        
      </ul>
    </div>

    
    <div id="toc-footer" style="display: none">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#cloudpanelio">CloudPanel.io</a></li>
    <li><a href="#modsecurity">ModSecurity</a></li>
    <li><a href="#coreruleset">CoreRuleSet</a></li>
    <li><a href="#installation">Installation</a>
      <ul>
        <li><a href="#cloudpanel">CloudPanel</a></li>
        <li><a href="#requirements">Requirements</a></li>
        <li><a href="#download-modsecurity">Download ModSecurity</a></li>
        <li><a href="#compile-modsecurity">Compile ModSecurity</a></li>
        <li><a href="#compile-the-nginx-connector">Compile the nginx connector</a></li>
        <li><a href="#download-coreruleset">Download CoreRuleSet</a></li>
        <li><a href="#configure-the-coreruleset--modsecurity">Configure the CoreRuleSet &amp; ModSecurity</a></li>
        <li><a href="#configure-nginx">Configure Nginx</a></li>
        <li><a href="#enable--verify">Enable &amp; Verify</a></li>
        <li><a href="#enable-coreruleset">Enable CoreRuleSet</a></li>
        <li><a href="#test-modsecurity">Test ModSecurity</a></li>
        <li><a href="#finish">Finish</a></li>
      </ul>
    </li>
    <li><a href="#attentione">Attentione</a></li>
    <li><a href="#quellen">Quellen</a></li>
  </ul>
</nav>
    </div>
    

    <div id="share-footer" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fberndklaus.at%2fposts%2fcloudpanel-io-modsecurity%2f" aria-label="Facebook">
      <i class="fab fa-facebook fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fberndklaus.at%2fposts%2fcloudpanel-io-modsecurity%2f&text=Adding%20ModSecurity%20to%20CloudPanel.io" aria-label="Twitter">
      <i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fberndklaus.at%2fposts%2fcloudpanel-io-modsecurity%2f&title=Adding%20ModSecurity%20to%20CloudPanel.io" aria-label="Linkedin">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fberndklaus.at%2fposts%2fcloudpanel-io-modsecurity%2f&is_video=false&description=Adding%20ModSecurity%20to%20CloudPanel.io" aria-label="Pinterest">
      <i class="fab fa-pinterest fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Adding%20ModSecurity%20to%20CloudPanel.io&body=Check out this article: https%3a%2f%2fberndklaus.at%2fposts%2fcloudpanel-io-modsecurity%2f" aria-label="Email">
      <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fberndklaus.at%2fposts%2fcloudpanel-io-modsecurity%2f&title=Adding%20ModSecurity%20to%20CloudPanel.io" aria-label="Pocket">
      <i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fberndklaus.at%2fposts%2fcloudpanel-io-modsecurity%2f&title=Adding%20ModSecurity%20to%20CloudPanel.io" aria-label="reddit">
      <i class="fab fa-reddit fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fberndklaus.at%2fposts%2fcloudpanel-io-modsecurity%2f&name=Adding%20ModSecurity%20to%20CloudPanel.io&description=CloudPanel.io%20CloudPanel%20beschreibt%20sich%20selbst%20wie%20folgt%3a%0aCloudPanel%20is%20a%20modern%20server%20control%20panel%20with%20lightweight%20components%20for%20PHP%20applications%20with%20specific%20features%20for%20all%20major%20clouds.%20It%20has%20been%20developed%20with%20more%20than%20ten%20years%20of%20Magento%20hosting%20experience%20in%20the%20AWS%20cloud.%20With%20CloudPanel%2c%20you%20can%20run%20your%20favorite%20PHP%20application%20in%20any%20cloud%20or%20dedicated%20server%20within%20minutes.%0aHomepage%3a%20https%3a%2f%2fwww.cloudpanel.io%0dIm%20unterschied%20zur%20Konkurrenz%20wie%20Beispielsweise%20CyberPanel%2c%20Plesk%20oder%20VestaCP%20konzentriet%20sich%20CloudPanel%20auf%20das%20wesentliche." aria-label="Tumblr">
      <i class="fab fa-tumblr fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fberndklaus.at%2fposts%2fcloudpanel-io-modsecurity%2f&t=Adding%20ModSecurity%20to%20CloudPanel.io" aria-label="Hacker News">
      <i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>

    <div id="actions-footer">
      
        <a id="menu-toggle" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;" aria-label="Menu">
          <i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
        <a id="toc-toggle" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;" aria-label="TOC">
          <i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share-toggle" class="icon" href="#" onclick="$('#share-footer').toggle();return false;" aria-label="Share">
          <i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
          <i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>


  <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2022  Bernd K. 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts">Posts</a></li>
         
        <li><a href="/about">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>

<script src=/js/code-copy.js></script>




</html>
