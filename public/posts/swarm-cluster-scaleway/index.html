<!DOCTYPE html>
<html lang="en-us">
<head>
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <script type="text/javascript" src="https://latest.cactus.chat/cactus.js"></script>
  <link rel="stylesheet" href="https://latest.cactus.chat/style.css" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> Swarm Cluster - High-Availability | berndklaus.at</title>
  <link rel = 'canonical' href = 'https://berndklaus.at/posts/swarm-cluster-scaleway/'>
  <meta name="description" content="A very warm welcome to my little space, glad you found it! News or current topics concerning IT, which I actually deal with, are published here on a cyclical basis. **Topics:** *#K8s #ITSecurity #CloudComputing #EdgeComputing #DevOps #Serverless*">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="Swarm Cluster - High-Availability" />
<meta property="og:description" content="Update 2020 Es hat sich bereits einiges getan, empfehlenswert ist aktuell der wechsel zu: Kubernetes
Setup Nichts desto trotz ist nachfolgendes Setup immer noch umsetzbar.
 Zuerst benötigen wir 3 virtuelle Maschinen, nicht möglich ist das Setup mit den VMs “C1″ und VC1S”, da wir eine 2. Disk benötigen. In meinem Setup kommt die VM “VC1M” zum Einsatz. Als Image ist im “ImageHub” die Docker Vorlage zu wählen.
2) Sobald die VMs provisioniert sind beginnen wir mit dem Basis-Setup:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://berndklaus.at/posts/swarm-cluster-scaleway/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-03-15T12:40:32+00:00" />
<meta property="article:modified_time" content="2017-03-15T12:40:32+00:00" />


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Swarm Cluster - High-Availability"/>
<meta name="twitter:description" content="Update 2020 Es hat sich bereits einiges getan, empfehlenswert ist aktuell der wechsel zu: Kubernetes
Setup Nichts desto trotz ist nachfolgendes Setup immer noch umsetzbar.
 Zuerst benötigen wir 3 virtuelle Maschinen, nicht möglich ist das Setup mit den VMs “C1″ und VC1S”, da wir eine 2. Disk benötigen. In meinem Setup kommt die VM “VC1M” zum Einsatz. Als Image ist im “ImageHub” die Docker Vorlage zu wählen.
2) Sobald die VMs provisioniert sind beginnen wir mit dem Basis-Setup:"/>

  
  
    
  
  
  <link rel="stylesheet" href="https://berndklaus.at/css/styles.aad1faec83a1003df3ee7287b7bdee1cb3a7b411021436c32f37e0c55ac71264c3944bcc1b35e12ac6c9f0249afdca485a9f510d1685639a35c84ba9367d6a6e.css" integrity="sha512-qtH67IOhAD3z7nKHt73uHLOntBECFDbDLzfgxVrHEmTDlEvMGzXhKsbJ8CSa/cpIWp9RDRaFY5o1yEupNn1qbg=="> 

  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://berndklaus.at/images/favicon.ico" />

  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

  <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts">Posts</a></li>
         
        <li><a href="/about">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li>
          <a class="icon" href=" https://berndklaus.at/posts/docker-errorlogs-push/" aria-label="Previous">
            <i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i>
          </a>
        </li>
        
        
        <li>
          <a class="icon" href="https://berndklaus.at/posts/docker-secure-cli-bastionhost/" aria-label="Next">
            <i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i>
          </a>
        </li>
        
        <li>
          <a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
            <i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="#" aria-label="Share">
            <i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
          </a>
        </li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fberndklaus.at%2fposts%2fswarm-cluster-scaleway%2f" aria-label="Facebook">
      <i class="fab fa-facebook " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fberndklaus.at%2fposts%2fswarm-cluster-scaleway%2f&text=Swarm%20Cluster%20-%20High-Availability" aria-label="Twitter">
      <i class="fab fa-twitter " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fberndklaus.at%2fposts%2fswarm-cluster-scaleway%2f&title=Swarm%20Cluster%20-%20High-Availability" aria-label="Linkedin">
      <i class="fab fa-linkedin " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fberndklaus.at%2fposts%2fswarm-cluster-scaleway%2f&is_video=false&description=Swarm%20Cluster%20-%20High-Availability" aria-label="Pinterest">
      <i class="fab fa-pinterest " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Swarm%20Cluster%20-%20High-Availability&body=Check out this article: https%3a%2f%2fberndklaus.at%2fposts%2fswarm-cluster-scaleway%2f" aria-label="Email">
      <i class="fas fa-envelope " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fberndklaus.at%2fposts%2fswarm-cluster-scaleway%2f&title=Swarm%20Cluster%20-%20High-Availability" aria-label="Pocket">
      <i class="fab fa-get-pocket " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fberndklaus.at%2fposts%2fswarm-cluster-scaleway%2f&title=Swarm%20Cluster%20-%20High-Availability" aria-label="reddit">
      <i class="fab fa-reddit " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fberndklaus.at%2fposts%2fswarm-cluster-scaleway%2f&name=Swarm%20Cluster%20-%20High-Availability&description=Update%202020%20Es%20hat%20sich%20bereits%20einiges%20getan%2c%20empfehlenswert%20ist%20aktuell%20der%20wechsel%20zu%3a%20Kubernetes%0aSetup%20Nichts%20desto%20trotz%20ist%20nachfolgendes%20Setup%20immer%20noch%20umsetzbar.%0a%20Zuerst%20ben%c3%b6tigen%20wir%203%20virtuelle%20Maschinen%2c%20nicht%20m%c3%b6glich%20ist%20das%20Setup%20mit%20den%20VMs%20%e2%80%9cC1%e2%80%b3%20und%20VC1S%e2%80%9d%2c%20da%20wir%20eine%202.%20Disk%20ben%c3%b6tigen.%20In%20meinem%20Setup%20kommt%20die%20VM%20%e2%80%9cVC1M%e2%80%9d%20zum%20Einsatz.%20Als%20Image%20ist%20im%20%e2%80%9cImageHub%e2%80%9d%20die%20Docker%20Vorlage%20zu%20w%c3%a4hlen.%0a2%29%20Sobald%20die%20VMs%20provisioniert%20sind%20beginnen%20wir%20mit%20dem%20Basis-Setup%3a" aria-label="Tumblr">
      <i class="fab fa-tumblr " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fberndklaus.at%2fposts%2fswarm-cluster-scaleway%2f&t=Swarm%20Cluster%20-%20High-Availability" aria-label="Hacker News">
      <i class="fab fa-hacker-news " aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>
    
    <div id="toc">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#update-2020">Update 2020</a></li>
    <li><a href="#setup">Setup</a>
      <ul>
        <li><a href="#verify">Verify</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
    
  </span>
</div>


  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 class="posttitle" itemprop="name headline">
        Swarm Cluster - High-Availability
      </h1>
      <div class="meta">
        
        <div class="postdate">
          
          <time datetime="2017-03-15 12:40:32.169 &#43;0000 UTC" itemprop="datePublished">2017-03-15</time>
          
        </div>
        
        
        
        
        <div class="article-tag">
            <i class="fas fa-tag"></i>
            
            
            <a class="tag-link" href="/tags/swarm" rel="tag">Swarm</a>
            
             ,  
            <a class="tag-link" href="/tags/docker" rel="tag">Docker</a>
            
             ,  
            <a class="tag-link" href="/tags/scaleway" rel="tag">Scaleway</a>
            
             ,  
            <a class="tag-link" href="/tags/container" rel="tag">Container</a>
            
        </div>
        
      </div>
    </header>

  
    
    <div class="content" itemprop="articleBody">
      <h2 id="update-2020">Update 2020</h2>
<p>Es hat sich bereits einiges getan, empfehlenswert ist aktuell der wechsel zu: <strong>Kubernetes</strong></p>
<h2 id="setup">Setup</h2>
<p>Nichts desto trotz ist nachfolgendes Setup immer noch umsetzbar.</p>
<figure><img src="/images/docker-swarm.png"
         alt="swarm" width="250px"/>
</figure>

<p><strong>Zuerst</strong> benötigen wir 3 virtuelle Maschinen, nicht möglich ist das Setup mit den VMs “C1″ und VC1S”, da wir eine 2. Disk benötigen. In meinem Setup kommt die VM “VC1M” zum Einsatz. Als Image ist im “ImageHub” die Docker Vorlage zu wählen.</p>
<p><strong>2)</strong>  Sobald die VMs provisioniert sind beginnen wir mit dem Basis-Setup:</p>
<pre tabindex="0"><code>apt-get update &amp;&amp; apt-get upgrade -y
mkfs -t ext4 /dev/vdb
mkdir -p /mnt/data
echo &quot;/dev/vdb /mnt/data auto  defaults,errors=remount-ro 0 2&quot; &gt;&gt; /etc/fstab
init 6
</code></pre><p>Docker wird auf Version 1.<strong>x</strong> aktualisiert, die 2. Datendisk wird formatiert und zu den Mountpunkt /mnt/data hinzugefügt.</p>
<p><strong>3)</strong> Damit die Container auf allen Hosts die gleichen Daten zur Verfügung haben gibt es einige Wege.  Eine Möglichkeit wäre der Einsatz eines Volume-Plugins welches eine Zieldestination automatisch auf dem Host mapped. Hier eine Liste der Verfügbaren Plugins.</p>
<p>In unserem Szenario wollen wir jedoch eine hoch verfügbare Umgebung aufbauen, dh. auch unser Speichersystem muss repliziert werden. Dazu verwenden wir glusterfs.</p>
<p>Glusterfs wird mit 3 Replicas angelegt, sprich pro Host eine Kopie der Daten. Somit entfällt der Schritt, dass Volumes gemappt werden müssen, da die Daten ohnehin auf jedem Host verfügbar sind. Damit jedoch <strong>“Named Volumes”</strong> verwendet werden können muss das Storage Plugin “local-persist” verwendet werden (Siehe Punkt 4).</p>
<p>Voraussetzung für GlusterFS ist das die privaten IPs auf den Hostname verweisen. Meine Hostnames lauten: Node01, Node02, Node03</p>
<pre tabindex="0"><code>apt-get install -y software-properties-common
add-apt-repository ppa:gluster/glusterfs-3.8
apt-get update &amp;&amp; apt-get install -y glusterfs-server
service glusterfs-server start
gluster peer probe node02
gluster peer probe node03
gluster peer status 
mkdir -p /mnt/gluster
gluster volume create gvol replica 3 node01:/mnt/gluster node02:/mnt/gluster node03:/mnt/gluster
gluster volume set gvol performance.cache-size 256MB
</code></pre><p>anschließend jeweils auf allen Nodes das Volume verbinden:anschließend jeweils auf allen Nodes das Volume verbinden:</p>
<pre tabindex="0"><code>echo &quot;Node1:/gvol0 /mnt/glusterfs glusterfs  defaults,_netdev 0 0&quot; &gt;&gt; /etc/fstab
init 6
</code></pre><p>Auf Node02, den String auch auf Node02 anpassen, sodass das Gluster Volume immer lokal verbunden wird.</p>
<p><strong>4)</strong> Nun installieren wir das Docker Plugin “local-persist” damit Named-Volumes auf unser Glusterfs gelegt werden können.</p>
<pre tabindex="0"><code>curl -fsSL https://raw.githubusercontent.com/CWSpear/local-persist/master/scripts/install.sh | sudo bash
</code></pre><p><strong>5)</strong> Als letzten Schritt initialisieren wir den Docker Swarm Cluster.</p>
<pre tabindex="0"><code>docker swarm init
docker swarm join-toker manager
</code></pre><p>die Ausgabe des letzen Befehles kopieren und auf den beiden anderen Nodes ausführen. Anschließend kann man wie folgt den Cluster Status abfragen:</p>
<h3 id="verify">Verify</h3>
<pre tabindex="0"><code>docker node ls
docker info
</code></pre><p>Unser hoch verfügbarer Swarm Cluster im neuen Swarm-Mode ist nun fertig.</p>

    </div>
  </article>

  
  






  <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/posts">Posts</a></li>
         
          <li><a href="/about">About</a></li>
        
      </ul>
    </div>

    
    <div id="toc-footer" style="display: none">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#update-2020">Update 2020</a></li>
    <li><a href="#setup">Setup</a>
      <ul>
        <li><a href="#verify">Verify</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
    

    <div id="share-footer" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fberndklaus.at%2fposts%2fswarm-cluster-scaleway%2f" aria-label="Facebook">
      <i class="fab fa-facebook fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fberndklaus.at%2fposts%2fswarm-cluster-scaleway%2f&text=Swarm%20Cluster%20-%20High-Availability" aria-label="Twitter">
      <i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fberndklaus.at%2fposts%2fswarm-cluster-scaleway%2f&title=Swarm%20Cluster%20-%20High-Availability" aria-label="Linkedin">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fberndklaus.at%2fposts%2fswarm-cluster-scaleway%2f&is_video=false&description=Swarm%20Cluster%20-%20High-Availability" aria-label="Pinterest">
      <i class="fab fa-pinterest fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Swarm%20Cluster%20-%20High-Availability&body=Check out this article: https%3a%2f%2fberndklaus.at%2fposts%2fswarm-cluster-scaleway%2f" aria-label="Email">
      <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fberndklaus.at%2fposts%2fswarm-cluster-scaleway%2f&title=Swarm%20Cluster%20-%20High-Availability" aria-label="Pocket">
      <i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fberndklaus.at%2fposts%2fswarm-cluster-scaleway%2f&title=Swarm%20Cluster%20-%20High-Availability" aria-label="reddit">
      <i class="fab fa-reddit fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fberndklaus.at%2fposts%2fswarm-cluster-scaleway%2f&name=Swarm%20Cluster%20-%20High-Availability&description=Update%202020%20Es%20hat%20sich%20bereits%20einiges%20getan%2c%20empfehlenswert%20ist%20aktuell%20der%20wechsel%20zu%3a%20Kubernetes%0aSetup%20Nichts%20desto%20trotz%20ist%20nachfolgendes%20Setup%20immer%20noch%20umsetzbar.%0a%20Zuerst%20ben%c3%b6tigen%20wir%203%20virtuelle%20Maschinen%2c%20nicht%20m%c3%b6glich%20ist%20das%20Setup%20mit%20den%20VMs%20%e2%80%9cC1%e2%80%b3%20und%20VC1S%e2%80%9d%2c%20da%20wir%20eine%202.%20Disk%20ben%c3%b6tigen.%20In%20meinem%20Setup%20kommt%20die%20VM%20%e2%80%9cVC1M%e2%80%9d%20zum%20Einsatz.%20Als%20Image%20ist%20im%20%e2%80%9cImageHub%e2%80%9d%20die%20Docker%20Vorlage%20zu%20w%c3%a4hlen.%0a2%29%20Sobald%20die%20VMs%20provisioniert%20sind%20beginnen%20wir%20mit%20dem%20Basis-Setup%3a" aria-label="Tumblr">
      <i class="fab fa-tumblr fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fberndklaus.at%2fposts%2fswarm-cluster-scaleway%2f&t=Swarm%20Cluster%20-%20High-Availability" aria-label="Hacker News">
      <i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>

    <div id="actions-footer">
      
        <a id="menu-toggle" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;" aria-label="Menu">
          <i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
        <a id="toc-toggle" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;" aria-label="TOC">
          <i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share-toggle" class="icon" href="#" onclick="$('#share-footer').toggle();return false;" aria-label="Share">
          <i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
          <i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>


  <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2022  Bernd K. 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts">Posts</a></li>
         
        <li><a href="/about">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>

<script src=/js/code-copy.js></script>




</html>
